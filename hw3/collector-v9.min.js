!function(){"use strict";const e={endpoint:"",enableVitals:!0,enableErrors:!0,sampleRate:1,debug:!1,respectConsent:!0,detectBots:!0};let t=!1,o=!1;const n={};let r=null;const i=[],a=new Set;let c=0;const s={lcp:null,cls:0,inp:null};let l=Date.now(),d=0;function u(e){return Math.round(100*e)/100}function f(){if(navigator.globalPrivacyControl)return!1;const e=document.cookie.split(";");for(const t of e){const e=t.trim();if(0===e.indexOf("analytics_consent="))return"true"===e.split("=")[1]}return!1}function p(){if(navigator.webdriver)return!0;const e=navigator.userAgent;return!!/HeadlessChrome|PhantomJS|Lighthouse/i.test(e)||(!(!/Chrome/.test(e)||window.chrome)||!!(window._phantom||window.__nightmare||window.callPhantom))}function m(){if(e.sampleRate>=1)return!0;if(e.sampleRate<=0)return!1;const t="_collector_sample";let o=sessionStorage.getItem(t);return null===o?(o=Math.random(),sessionStorage.setItem(t,o)):o=parseFloat(o),o<e.sampleRate}function g(){let e=sessionStorage.getItem("_collector_sid");return e||(e=Math.random().toString(36).substring(2)+Date.now().toString(36),sessionStorage.setItem("_collector_sid",e)),e}function h(){if(!("connection"in navigator))return{};const e=navigator.connection;return{effectiveType:e.effectiveType,downlink:e.downlink,rtt:e.rtt,saveData:e.saveData}}function w(){return{userAgent:navigator.userAgent,language:navigator.language,cookiesEnabled:navigator.cookieEnabled,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,screenWidth:window.screen.width,screenHeight:window.screen.height,pixelRatio:window.devicePixelRatio,cores:navigator.hardwareConcurrency||0,memory:navigator.deviceMemory||0,network:h(),colorScheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}}function v(){const e=performance.getEntriesByType("navigation");if(!e.length)return{};const t=e[0];return{dnsLookup:u(t.domainLookupEnd-t.domainLookupStart),tcpConnect:u(t.connectEnd-t.connectStart),tlsHandshake:t.secureConnectionStart>0?u(t.connectEnd-t.secureConnectionStart):0,ttfb:u(t.responseStart-t.requestStart),download:u(t.responseEnd-t.responseStart),domInteractive:u(t.domInteractive-t.fetchStart),domComplete:u(t.domComplete-t.fetchStart),loadEvent:u(t.loadEventEnd-t.fetchStart),fetchTime:u(t.responseEnd-t.fetchStart),transferSize:t.transferSize,headerSize:t.transferSize-t.encodedBodySize}}function y(){const e=performance.getEntriesByType("resource"),t={script:{count:0,totalSize:0,totalDuration:0},link:{count:0,totalSize:0,totalDuration:0},img:{count:0,totalSize:0,totalDuration:0},font:{count:0,totalSize:0,totalDuration:0},fetch:{count:0,totalSize:0,totalDuration:0},xmlhttprequest:{count:0,totalSize:0,totalDuration:0},other:{count:0,totalSize:0,totalDuration:0}};return e.forEach(e=>{const o=t[e.initiatorType]?e.initiatorType:"other";t[o].count++,t[o].totalSize+=e.transferSize||0,t[o].totalDuration+=e.duration||0}),{totalResources:e.length,byType:t}}function S(){return{lcp:s.lcp,cls:s.cls,inp:s.inp}}function E(e){if(c>=10)return;const t=`${e.type}:${e.message||""}:${e.source||""}:${e.line||""}`;a.has(t)||(a.add(t),c++,_({type:"error",error:e,timestamp:(new Date).toISOString(),url:window.location.href,session:g()}),window.dispatchEvent(new CustomEvent("collector:error",{detail:{errorData:e,count:c}})))}function _(t){const o="function"==typeof performance.mark;if(o&&performance.mark("collector_send_start"),e.debug)return void console.log("[Collector] Debug payload:",t);if(!e.endpoint)return void console.warn("[Collector] No endpoint configured");const n=JSON.stringify(t);let r=!1;navigator.sendBeacon&&(r=navigator.sendBeacon(e.endpoint,new Blob([n],{type:"application/json"}))),r||fetch(e.endpoint,{method:"POST",body:n,headers:{"Content-Type":"application/json"},keepalive:!0}).catch(()=>{!function(e){try{const t=JSON.parse(sessionStorage.getItem("_collector_retry")||"[]");if(t.length>=50)return;t.push(e),sessionStorage.setItem("_collector_retry",JSON.stringify(t))}catch(e){}}(t)}),o&&(performance.mark("collector_send_end"),performance.measure("collector_send","collector_send_start","collector_send_end")),window.dispatchEvent(new CustomEvent("collector:beacon",{detail:t}))}function b(e){let t={type:e||"pageview",url:window.location.href,title:document.title,referrer:document.referrer,timestamp:(new Date).toISOString(),session:g(),technographics:w(),timing:v(),resources:y(),vitals:S(),errorCount:c,customData:n};r&&(t.userId=r),i.forEach(e=>{if("function"==typeof e.beforeSend){const o=e.beforeSend(t);if(!1===o)return;o&&"object"==typeof o&&(t=o)}}),_(t),window.dispatchEvent(new CustomEvent("collector:payload",{detail:t}))}const C={init:function(n){if(t)console.warn("[Collector] Already initialized");else{if("function"==typeof performance.mark&&performance.mark("collector_init_start"),n&&function(e,t){for(const o of Object.keys(t))e[o]=t[o]}(e,n),e.respectConsent&&!f())return console.log("[Collector] No consent â€” collection disabled"),o=!0,void(t=!0);if(e.detectBots&&p())return console.log("[Collector] Bot detected â€” collection disabled"),o=!0,void(t=!0);if(!m())return console.log(`[Collector] Session not sampled (rate: ${e.sampleRate})`),o=!0,void(t=!0);t=!0,console.log("[Collector] Initialized",e),e.enableVitals&&function(){try{new PerformanceObserver(e=>{const t=e.getEntries();t.length&&(s.lcp=u(t[t.length-1].startTime))}).observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{e.hadRecentInput||(s.cls=u(s.cls+e.value))})}).observe({type:"layout-shift",buffered:!0})}catch(e){}try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{(null===s.inp||e.duration>s.inp)&&(s.inp=u(e.duration))})}).observe({type:"event",buffered:!0,durationThreshold:16})}catch(e){}}(),e.enableErrors&&(window.addEventListener("error",e=>{if(e instanceof ErrorEvent)E({type:"js-error",message:e.message,source:e.filename,line:e.lineno,column:e.colno,stack:e.error?e.error.stack:"",url:window.location.href});else{const t=e.target;!t||"IMG"!==t.tagName&&"SCRIPT"!==t.tagName&&"LINK"!==t.tagName||E({type:"resource-error",tagName:t.tagName,src:t.src||t.href||"",url:window.location.href})}},!0),window.addEventListener("unhandledrejection",e=>{const t=e.reason;E({type:"promise-rejection",message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:"",url:window.location.href})})),document.addEventListener("visibilitychange",()=>{if("hidden"===document.visibilityState){d+=Date.now()-l;const e={type:"page_exit",url:window.location.href,timeOnPage:d,vitals:S(),errorCount:c,timestamp:(new Date).toISOString(),session:g()};i.forEach(t=>{"function"==typeof t.onExit&&t.onExit(e)}),_(e)}else l=Date.now()}),function(){try{const e=JSON.parse(sessionStorage.getItem("_collector_retry")||"[]");if(!e.length)return;sessionStorage.removeItem("_collector_retry"),e.forEach(e=>{_(e)})}catch(e){}}(),"complete"===document.readyState?setTimeout(()=>{b("pageview")},0):window.addEventListener("load",()=>{setTimeout(()=>{b("pageview")},0)}),"function"==typeof performance.mark&&(performance.mark("collector_init_end"),performance.measure("collector_init","collector_init_start","collector_init_end"))}},track:function(e,i){if(!t||o)return;const a={type:"event",event:e,data:i||{},timestamp:(new Date).toISOString(),url:window.location.href,session:g(),customData:n};r&&(a.userId=r),_(a)},set:function(e,t){n[e]=t},identify:function(e){r=e},use:function(t){t&&"object"==typeof t?(i.push(t),"function"==typeof t.init&&t.init(e),console.log(`[Collector] Plugin registered: ${t.name||"(unnamed)"}`)):console.warn("[Collector] Invalid plugin")}};!function(){const e=window._cq||[];for(const t of e){const e=t[0],o=t.slice(1);"function"==typeof C[e]&&C[e](...o)}window._cq={push:e=>{const t=e[0],o=e.slice(1);"function"==typeof C[t]&&C[t](...o)}}}(),window.__collector={getNavigationTiming:v,getResourceSummary:y,getTechnographics:w,getWebVitals:S,getSessionId:g,getNetworkInfo:h,reportError:E,collect:b,hasConsent:f,isBot:p,isSampled:m,getErrorCount:()=>c,getConfig:()=>e,isBlocked:()=>o,api:C}}();